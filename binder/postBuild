#!/bin/bash

set -euxo pipefail

time curl https://sh.rustup.rs -sSf | sh -s -- --default-toolchain=nightly-2020-07-27 -y

# Share our build directory between all executions.
# See https://github.com/google/evcxr/issues/52#issuecomment-520266256
export EVCXR_TMPDIR=$HOME/evcxr_build
source $HOME/.cargo/env

echo '
export EVCXR_TMPDIR=$HOME/evcxr_build
source $HOME/.cargo/env
' >> ~/.bashrc
echo '
export EVCXR_TMPDIR=$HOME/evcxr_build
source $HOME/.cargo/env
' >> ~/.profile

time cargo install evcxr_jupyter
time evcxr_jupyter --install


# Pre-populate build directory as part of the docker image.
time echo ':dep arrow = "1.0"' | jupyter console --kernel=rust
